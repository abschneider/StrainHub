!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(require('leaflet')):typeof define==='function'&&define.amd?define(['leaflet'],b):(b(a.L))}(this,(function(a){'use strict';a=a&&a.hasOwnProperty('default')?a['default']:a;L.Curve=L.Path.extend({options:{},initialize:function(a,b){L.setOptions(this,b);this._initialUpdate=!0;this._setPath(a)},getPath:function(){return this._coords},setPath:function(a){this._setPath(a);return this.redraw()},getBounds:function(){return this._bounds},_setPath:function(a){this._coords=a;this._bounds=this._computeBounds()},_computeBounds:function(){var a=new L.LatLngBounds(),b,c,d;for(var e=0;e<this._coords.length;e++){d=this._coords[e];if(typeof d=='string'||d instanceof String)c=d;else if(c=='H')a.extend([b.lat,d[0]]),b=new L.latLng(b.lat,d[0]);else if(c=='V')a.extend([d[0],b.lng]),b=new L.latLng(d[0],b.lng);else if(c=='C'){var f=new L.latLng(d[0],d[1]);d=this._coords[++e];var g=new L.latLng(d[0],d[1]);d=this._coords[++e];var h=new L.latLng(d[0],d[1]);a.extend(f);a.extend(g);a.extend(h);h.controlPoint1=f;h.controlPoint2=g;b=h}else if(c=='S'){g=new L.latLng(d[0],d[1]);d=this._coords[++e];h=new L.latLng(d[0],d[1]),f=b;if(b.controlPoint2){var i=b.lat-b.controlPoint2.lat,j=b.lng-b.controlPoint2.lng;f=new L.latLng(b.lat+i,b.lng+j)}a.extend(f);a.extend(g);a.extend(h);h.controlPoint1=f;h.controlPoint2=g;b=h}else if(c=='Q'){var k=new L.latLng(d[0],d[1]);d=this._coords[++e];h=new L.latLng(d[0],d[1]);a.extend(k);a.extend(h);h.controlPoint=k;b=h}else if(c=='T'){h=new L.latLng(d[0],d[1]),k=b;if(b.controlPoint){i=b.lat-b.controlPoint.lat,j=b.lng-b.controlPoint.lng;k=new L.latLng(b.lat+i,b.lng+j)}a.extend(k);a.extend(h);h.controlPoint=k;b=h}else a.extend(d),b=new L.latLng(d[0],d[1])}return a},getCenter:function(){return this._bounds.getCenter()},_update:function(){if(!this._map){return}this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},_project:function(){var a,b,c,d;this._points=[];for(var e=0;e<this._coords.length;e++){a=this._coords[e];if(typeof a=='string'||a instanceof String)this._points.push(a),c=a;else{switch(a.length){case 2:d=this._map.latLngToLayerPoint(a);b=a;break;case 1:c=='H'?(d=this._map.latLngToLayerPoint([b[0],a[0]]),b=[b[0],a[0]]):(d=this._map.latLngToLayerPoint([a[0],b[1]]),b=[a[0],b[1]]);break};this._points.push(d)}}}});L.curve=function(a,b){return new L.Curve(a,b)};L.SVG.include({_updatecurve:function(a){this._setPath(a,this._curvePointsToPath(a._points));if(a.options.animate){var b=a._path,c=b.getTotalLength();a.options.dashArray||(b.style.strokeDasharray=c+' '+c);a._initialUpdate&&(b.animate([{strokeDashoffset:c},{strokeDashoffset:0}],a.options.animate),a._initialUpdate=!1)}},_curvePointsToPath:function(a){var b,c,d='';for(var e=0;e<a.length;e++){b=a[e];if(typeof b=='string'||b instanceof String)c=b,d+=c;else{switch(c){case 'H':d+=b.x+' ';break;case 'V':d+=b.y+' ';break;default:d+=b.x+','+b.y+' ';break}}}return d||'M0 0'}});function b(a,b,c){c=c||{};if(!f(c))throw new Error('options is invalid');var d=c.bbox,e=c.id;if(a===undefined)throw new Error('geometry is required');if(b&&b.constructor!==Object)throw new Error('properties must be an Object');d&&g(d);e&&h(e);var i={type:'Feature'};e&&(i.id=e);d&&(i.bbox=d);i.properties=b||{};i.geometry=a;return i}function c(a,c,d){if(!a)throw new Error('coordinates is required');if(!Array.isArray(a))throw new Error('coordinates must be an Array');if(a.length<2)throw new Error('coordinates must be at least 2 numbers long');if(!e(a[0])||!e(a[1]))throw new Error('coordinates must contain numbers');return b({type:'Point',coordinates:a},c,d)}function d(a,b){b=b||{};if(!f(b))throw new Error('options is invalid');var c=b.bbox,d=b.id;if(!a)throw new Error('No features passed');if(!Array.isArray(a))throw new Error('features must be an Array');c&&g(c);d&&h(d);var e={type:'FeatureCollection'};d&&(e.id=d);c&&(e.bbox=c);e.features=a;return e}function e(a){return!isNaN(a)&&a!==null&&!Array.isArray(a)}function f(a){return!!a&&a.constructor===Object}function g(a){if(!a)throw new Error('bbox is required');if(!Array.isArray(a))throw new Error('bbox must be an Array');if(a.length!==4&&a.length!==6)throw new Error('bbox must be an Array of 4 or 6 numbers');a.forEach(function(a){if(!e(a))throw new Error('bbox must only contain numbers')})}function h(a){if(!a)throw new Error('id is required');if(['string','number'].indexOf(typeof a)===-1)throw new Error('id must be a number or a string')}function i(a,b,c){if(a===null)return;var d,e,f,g,h,j,k,l=0,m=0,n,o=a.type,p=o==='FeatureCollection',q=o==='Feature',r=p?a.features.length:1;for(var s=0;s<r;s++){k=p?a.features[s].geometry:(q?a.geometry:a);n=k?k.type==='GeometryCollection':!1;h=n?k.geometries.length:1;for(var t=0;t<h;t++){var u=0,v=0;g=n?k.geometries[t]:k;if(g===null)continue;j=g.coordinates;var w=g.type;l=c&&(w==='Polygon'||w==='MultiPolygon')?1:0;switch(w){case null:break;case 'Point':if(b(j,m,s,u,v)===!1)return !1;m++;u++;break;case 'LineString':;case 'MultiPoint':for(d=0;d<j.length;d++){if(b(j[d],m,s,u,v)===!1)return !1;m++;w==='MultiPoint'&&u++};w==='LineString'&&u++;break;case 'Polygon':;case 'MultiLineString':for(d=0;d<j.length;d++){for(e=0;e<j[d].length-l;e++){if(b(j[d][e],m,s,u,v)===!1)return !1;m++}w==='MultiLineString'&&u++;w==='Polygon'&&v++};w==='Polygon'&&u++;break;case 'MultiPolygon':for(d=0;d<j.length;d++){w==='MultiPolygon'&&(v=0);for(e=0;e<j[d].length;e++){for(f=0;f<j[d][e].length-l;f++){if(b(j[d][e][f],m,s,u,v)===!1)return !1;m++}v++}u++};break;case 'GeometryCollection':for(d=0;d<g.geometries.length;d++)if(i(g.geometries[d],b,c)===!1)return !1;break;default:throw new Error('Unknown Geometry Type')}}}}function j(a){var b=[Infinity,Infinity,-Infinity,-Infinity];i(a,function(a){b[0]>a[0]&&(b[0]=a[0]);b[1]>a[1]&&(b[1]=a[1]);b[2]<a[0]&&(b[2]=a[0]);b[3]<a[1]&&(b[3]=a[1])});return b}function k(a,b){b=b||{};if(!f(b))throw new Error('options is invalid');var d=b.properties;if(!a)throw new Error('geojson is required');var e=j(a),g=(e[0]+e[2])/2,h=(e[1]+e[3])/2;return c([g,h],d)}var l=0;a.SwoopyArrow=a.Layer.extend({fromLatlng:[],toLatlng:[],options:{color:'#222222',weight:1,opacity:1,factor:0.5,arrowFilled:!1,hideArrowHead:!1,arrowId:null,minZoom:0,maxZoom:22,label:'',labelClassName:'',labelFontSize:12,labelColor:'#222222',html:'',iconAnchor:[0,0],iconSize:[50,20]},initialize:function e(b,c,d){a.Util.setOptions(this,d);this._currentPathVisible=!0;this._fromLatlng=a.latLng(b);this._toLatlng=a.latLng(c);this._factor=this.options.factor;this._label=this.options.label;this._labelFontSize=this.options.labelFontSize;this._labelColor=this.options.labelColor;this._color=this.options.color;this._labelClassName=this.options.labelClassName;this._html=this.options.html;this._opacity=this.options.opacity;this._minZoom=this.options.minZoom;this._maxZoom=this.options.maxZoom;this._iconAnchor=this.options.iconAnchor;this._iconSize=this.options.iconSize;this._weight=this.options.weight;this._arrowFilled=this.options.arrowFilled;this._hideArrowHead=this.options.hideArrowHead;this._arrowId=this.options.arrowId;this._initSVG()},_initSVG:function b(){this._svg=a.SVG.create('svg');this._currentId=l++;this._arrow=this._createArrow();this._svg.appendChild(this._arrow)},onAdd:function b(a){this._map=a;this.getPane().appendChild(this._svg);this._drawSwoopyArrows();this.update(this._map)},getEvents:function a(){return{zoom:this.update,viewreset:this.update}},_drawSwoopyArrows:function b(){var c=this._createPath();this._currentPath=c._path;var d=this._createLabel();this._currentMarker=a.marker([this._fromLatlng.lat,this._fromLatlng.lng],{icon:d}).addTo(this._map)},_createArrow:function b(){this._container=this._container||a.SVG.create('defs');var c=a.SVG.create('marker'),d=a.SVG.create('polyline');c.setAttribute('class','swoopyArrow__marker');c.setAttribute('id','swoopyarrow__arrowhead'+this._currentId);c.setAttribute('markerWidth','6.75');c.setAttribute('markerHeight','6.75');c.setAttribute('viewBox','-10 -10 20 20');c.setAttribute('orient','auto');c.setAttribute('refX','0');c.setAttribute('refY','0');c.setAttribute('fill','none');c.setAttribute('stroke',this._color);c.setAttribute('stroke-width',this._weight);c.setAttribute('opacity',this._opacity);this._hideArrowHead||(d.setAttribute('stroke-linejoin','bevel'),d.setAttribute('fill',this._arrowFilled?this._color:'none'),d.setAttribute('stroke',this._color),d.setAttribute('points','-6.75,-6.75 0,0 -6.75,6.75'),c.appendChild(d));this._container.appendChild(c);return this._container},_createPath:function b(){var c=this._getControlPoint(a.latLng(this._fromLatlng),a.latLng(this._toLatlng),this.options.factor),d=a.curve(['M',[this._fromLatlng.lat,this._fromLatlng.lng],'Q',[c.lat,c.lng],[this._toLatlng.lat,this._toLatlng.lng]],{animate:!1,color:this._color,fill:!1,opacity:this._opacity,weight:this._weight,className:'swoopyarrow__path'}).addTo(this._map);d._path.setAttribute('id','swoopyarrow__path'+this._currentId);d._path.setAttribute('marker-end',!this._arrowId?'url(#swoopyarrow__arrowhead'+this._currentId+')':'url('+this._arrowId+')');return d},_rotatePoint:function d(a,b,c){var e=c*Math.PI/180.0;return{x:Math.cos(e)*(b.x-a.x)-Math.sin(e)*(b.y-a.y)+a.x,y:Math.sin(e)*(b.x-a.x)+Math.cos(e)*(b.y-a.y)+a.y}},_getControlPoint:function g(b,e,f){var h=d([c([b.lat,b.lng]),c([e.lat,e.lng])]),i=k(h),j=this._map.latLngToContainerPoint(b),l=this._map.latLngToContainerPoint(a.latLng(i.geometry.coordinates[0],i.geometry.coordinates[1])),m=this._rotatePoint(l,j,90),n=Math.sqrt(Math.pow(j.x-l.x,2)+Math.pow(j.y-l.y,2)),o=Math.atan2(m.y-l.y,m.x-l.x),p=f*n-n,q=Math.sin(o)*p,r=Math.cos(o)*p,s=a.point(m.x+r,m.y+q);return this._map.containerPointToLatLng(s)},_createLabel:function b(){return a.divIcon({className:this._html===''&&this._labelClassName,html:this._html===''?'<span id="marker-label'+this._currentId+'" style="font-size: '+this._labelFontSize+'px; color: '+this._labelColor+'">'+this._label+'</span>':this._html,iconAnchor:this._iconAnchor,iconSize:this._iconSize})},update:function b(a){this._checkZoomLevel();var c=this._svg.getElementById('swoopyarrow__arrowhead'+this._currentId);c.setAttribute('markerWidth',''+2.5*this._map.getZoom());c.setAttribute('markerHeight',''+2.5*this._map.getZoom());return this},_checkZoomLevel:function a(){var b=this._map.getZoom();this._currentPathVisible||(this._currentPath.setAttribute('opacity',this._opacity),this._currentMarker.setOpacity(this._opacity));(b<this._minZoom||b>this._maxZoom)&&(this._currentPath.setAttribute('opacity',0),this._currentMarker.setOpacity(0),this._currentPathVisible=!1)},onRemove:function b(a){this._map=a;this._currentPath.parentNode.removeChild(this._currentPath);this._map.removeLayer(this._currentMarker)}});a.swoopyArrow=function(b,c,d){return new a.SwoopyArrow(b,c,d)}}))
//# sourceMappingURL=Leaflet.SwoopyArrow.min.js.map
